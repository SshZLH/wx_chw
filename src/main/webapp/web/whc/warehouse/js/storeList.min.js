function warList(a,b){wx.getLocation({success:function(c){var d=c.latitude,e=c.longitude;start=new qq.maps.LatLng(d,e),getStoreList(start,a,b)},fail:function(){getStoreList(null,a,b)}})}function getStoreList(start,_wahoType,_keyWord){$.ajax({type:"GET",async:!1,url:baseURL+"dataMessageService?_webserviceName=GetWarehouseList",data:{wahoType:_wahoType,keyWord:_keyWord},success:function(msg){var json,i,listDiv,orderList=document.getElementById("storeList"),jsonObj=eval("("+msg+")");if(0==jsonObj.dataSet.length)orderList.innerHTML='<div class="searchInputTxt">未搜到符合条件的门店,请输入其它内容</div>',$(".returnLast").on("click",function(){window.location.reload()});else{for(json=jsonObj.dataSet[0].entityList,null!=start&&(json=sortWarehouseList(json,start)),i=0;i<json.length;i++)listDiv=document.createElement("div"),listDiv.className="storeInfo",listDiv.innerHTML="",(0==i||json[i].type7<200)&&(listDiv.innerHTML+='<img src="img/zj.png" class="zj" /><img src="img/zj1.png" class="zj1"/>'),listDiv.innerHTML+='<div class="right">                  <img class="right_img" src='+supportUrl+"app/whc/uploadFile/import/"+json[i].image1+'>                  <img class="preloading" src="img/Preloading.png"/>                  <div class="info">                   <div class="top">'+json[i].name+'</div>                   <div class="bottom">                    <img src="img/address.png" class="posImg" />                    <div class="addrInfo">                     <div class="top">'+json[i].addr.substring(0,13)+'...</div>                     <div class="bottom">距离 '+json[i].type9+'</div>                    </div>                   </div>                   <div class="Prides">                    <p class="rise">起</p>               <p class="yuan">'+json[i].price+'</p>               <p class="money">￥</p>                   </div>                  </div>                </div>',orderList.appendChild(listDiv),$(".loading22").hide();$(".storeInfo").each(function(a){$(this).on("click",function(){window.location.href="/app/whc2/cabinetMenu/index.html?openId="+openId+"&warehouseId="+json[a].id}),$(".right_img").eq(a).load(function(){$(".preloading").eq(a).hide()}),a>4&&$(".storeInfo").eq(a).addClass("divHide")})}$(".storeList").dropload({scrollArea:window,loadDownFn:function(a){setTimeout(function(){$(".storeInfo.divHide").eq(0).removeClass("divHide"),$(".storeInfo.divHide").eq(1).removeClass("divHide"),$(".storeInfo.divHide").eq(2).removeClass("divHide"),$(".storeInfo.divHide").eq(3).removeClass("divHide"),a.resetload()},1e3),0==$(".storeInfo.divHide").length&&(a.lock(),a.noData())}}),0==jsonObj.dataSet.length&&($(".dropload-down").remove(),$(".dropload-noData").remove())},error:function(){alert("失败")}})}function sortWarehouseList(a,b){var c,d,e,f,g=new Array;for(c=0;c<a.length;c++)d=new qq.maps.LatLng(parseFloat(a[c].lati),parseFloat(a[c].longi)),e=Math.round(10*qq.maps.geometry.spherical.computeDistanceBetween(b,d))/10,f=a[c],parseFloat(a[c].disLevel1),parseFloat(a[c].disLevel2),parseFloat(a[c].disLevel3),f.type7=e,e>1e3?e=Math.round(10*(e/1e3))/10+"km":e+="m",f.type9=e,g.push(f);return g.sort(compare("type7")),g}function compare(a){return function(b,c){var d=b[a],e=c[a];return d>e?1:e>d?-1:0}}var openId,wahoType,supportUrl,baseURL,str,strOpenId,strOpenIdlist,strWahoType,strWahoTypelist,start=null,url=location.search;-1!=url.indexOf("?")&&(str=url.substr(1),strs=str.split("&"),strOpenId=strs[0],strOpenIdlist=strOpenId.split("="),openId=strOpenIdlist[1],strWahoType=strs[1],strWahoTypelist=strWahoType.split("="),wahoType=strWahoTypelist[1]),$(function(){$(window).scroll(function(){$(window).scrollTop()>=100?$(".flyTop").fadeIn(300):$(".flyTop").fadeOut(300)}),$(".flyTop").click(function(){$("html,body").animate({scrollTop:"0px"},800)}),$(".returnLast").on("click",function(){$(".search_btn").hide(),$(this).hide(),$(".searchInput").css({width:"7.13rem"}),$(".searchInput").val("搜索门店、位置")}),$(".list1").on("click",function(){$(".list1_top img").attr("src","img/save_blue_icon .png"),$(".list1_bottom").css({color:"#00aaee"}),$(".list2_top img").attr("src","img/take_black_icon.png"),$(".list2_bottom").css({color:"#444444"}),$(".list3_top img").attr("src","img/warehouse_black_icon.png"),$(".list3_bottom").css({color:"#444444"}),window.location.href="/app/whc2/storeList/index.html?openId="+openId+"&wahoType=11"}),$(".list2").on("click",function(){$(".list1_top img").attr("src","img/save_black_icon.png"),$(".list1_bottom").css({color:"#444444"}),$(".list3_top img").attr("src","img/warehouse_black_icon.png"),$(".list3_bottom").css({color:"#444444"}),$(".list2_top img").attr("src","img/take_blue_icon.png"),$(".list2_bottom").css({color:"#00aaee"}),window.location.href="/app/whc2/member/center.html?openId="+openId}),$(".list3").on("click",function(){$(".list1_top img").attr("src","img/save_black_icon.png"),$(".list1_bottom").css({color:"#444444"}),$(".list2_top img").attr("src","img/take_black_icon.png"),$(".list2_bottom").css({color:"#444444"}),$(".list3_top img").attr("src","img/warehouse_blue_icon.png"),$(".list3_bottom").css({color:"#00aaee"}),window.location.href="/app/whc/warehouse/warehouseList.jsp?openId="+openId+"&wahoType=0"}),$(".searchInput").focus(function(){$(this).css("width","5.85rem"),$(this).css({color:"#5c5d5d"}),$(".returnLast").show(),$(".search_btn").show(),$(this).val(""),$(".searchButton").hide()}),$(".search_btn").on("click",function(){$("#storeList").html(""),$(".searchInput").css({color:"#5c5d5d"}),warList("1",$(".searchInput").val())}),$.ajax({type:"GET",async:!1,data:{openId:openId,url:window.location.href},url:"/whc/warehouse/action/getwarehouseListAction.do",success:function(a){supportUrl=a.supportUrl,baseURL=a.baseURL,appId=a.appId,timestamp=a.timestamp,nonceStr=a.nonceStr,signature=a.signature,wx.config({debug:!1,appId:appId,timestamp:timestamp,nonceStr:nonceStr,signature:signature,jsApiList:["getLocation"]})},error:function(){alert("失败")}})}),wx.ready(function(){warList("1")}),wx.error(function(){});